---
title: "netflix_transmutation"
author: "@grevend, @Fynn-Mehrens"
date: "13 12 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(knitr)
install.packages("viridis")
library(viridis)
read_chunk('shared_functions.R')
```

## Importing from other Rmd file

This section parses the data from the "netflix_originals.Rmd" file that imported all the data from the scraped CSV files. It saves them into the data frame called "netflix_originals" so that it ca be accessed and manipulated later on.

```{r child = 'netflix_originals.Rmd'}
```

```{r}
netflix_originals <- netflix_originals
netflix_originals
```

## Transmutation of the given Netflix series and movie table

After the data has been imported into the correct columns in the "netflix_originals.Rmd" file, we are now going to transmute the data into the proper data types and into readable formats, as it is needed with multi-value cells like the Genre. For this, we needed a function that parses the value of the cells for the Genre and unifies the content, so that we can be sure that it is in a format that can be properly plotted afterwards.

After the function has been defined, we can start converting the columns of the data frame into their respective data types, so that it is easier to deal with them during the plotting process. This means, that the premiere is being converted into a Date object and the Seasons column as well as the Runtime column are converted and split up, so that there are only integer values left. The rest of the columns is just carried over.

```{r code = readlines("shared_functions.R")}
netflix_originals <- filter(netflix_originals,
                            !grepl("Pending|pending", Title),
                            Title != "Awaiting release",
                            !grepl("Miniseries|miniseries", Title),
                            !grepl("Renewed|renewed", Title),
                            !grepl("due to premiere", Title))

netflix_originals

netflix <- transmute(netflix_originals, 
                                Title = Title,
                                Genre = genres_to_uppercase(str_replace_all(
                                          str_squish(
                                            str_replace_all(
                                              str_replace_all(
                                                str_replace_all(
                                                  str_replace_all(
                                                    str_replace_all(Genre, "series|procedural", ""),
                                                  "Science fiction", "Science-Fiction"),
                                                "(C|c)oming-of-age ", ""),
                                              "(C|c)omedy-(D|d)rama", "Dramedy"),
                                            "(Docu|docu).*", "Documentary")
                                          ),
                                        "/| ", " / ")),
                                Premiere = as.Date(str_replace_all(str_replace_all(Premiere, ",", ""), " ", "-"), "%B-%d-%Y"),
                                Episodes = strtoi(ifelse(!is.na(str_match(Seasons, "([0-9]+) (episode*)")[,2]),
                                                  str_match(Seasons, "([0-9]+) (episode*)")[,2],
                                                  NA)),
                                Seasons = strtoi(ifelse(!is.na(str_match(Seasons, "([0-9]) (season.*|part.*|volume.*)")[,2]),
                                                  str_match(Seasons, "([0-9]) (season.*|part.*|volume.*)")[,2],
                                                  NA)),
                                Min_Time = strtoi(ifelse(!is.na(str_match(Runtime, "([0-9]+)-([0-9]+)")[,2]),
                                                  str_match(Runtime, "([0-9]+)-([0-9]+)")[,2],
                                                  str_match(Runtime, "([0-9]+)")[,2])),
                                Max_Time = strtoi(ifelse(!is.na(str_match(Runtime, "([0-9]+)-([0-9]+)")[,3]),
                                                  str_match(Runtime, "([0-9]+)-([0-9]+)")[,3],
                                                  str_match(Runtime, "([0-9]+)")[,2])),
                                Language = Language,
                                Status = Status,
                                Format = as.factor(Format),
                                Origin = as.factor(Origin),
                                Network = as.factor(Network),
                                Region = as.factor(Region),
                                Streaming_Service = as.factor("Netflix")
                               )

netflix
```