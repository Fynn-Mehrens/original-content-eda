---
title: "netflix_transmutation"
author: "@grevend, @Fynn-Mehrens"
date: "13 12 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

## Importing from other Rmd file

```{r child = 'netflix_originals.Rmd'}
```

```{r}
netflix_originals <- netflix_originals
# netflix_originals <- read.csv("../datasets/netflix_originals.csv")
netflix_originals
```

## Transmutation of the given Netflix series and movie table

```{r}
test_string <- "Police / anthology"

anycharacter <- "(A-Z|a-z)"

genres_to_uppercase <- function(genres) {
  curr <- ""
  all_genres <- ""
  for (i in 1:length(strsplit(genres, "")[[1]])) {
    c <- strsplit(genres, "")[[1]]
    print(paste(c(c[i], ": ", grepl(anycharacter, c[i])), ""))
    if(grepl(anycharacter, c[i])) {
      curr <- paste(c(curr, c[i]), "")
    } else {
      whole_word = strsplit(curr, "")[[1]]
      for (j in 1:length(whole_word)) {
        if (j == 1) {
          curr <- toupper(whole_word[j])
        } else {
          curr <- paste(c(curr, tolower(whole_word[j])), "")
        }
      }
      
      if (i != length(strsplit(genres, "")[[1]])) {
        all_genres <- paste(c(all_genres, curr, " / "), "")
      } else {
        all_genres <- paste(c(all_genres, curr), "")
      }
      curr <- ""
    }
  }
  return(all_genres)
}

strsplit(test_string, "")[[1]]


genres_to_uppercase(test_string)
```


```{r}
netflix_originals <- filter(netflix_originals,
                            !grepl("Pending|pending", Title),
                            Title != "Awaiting release",
                            !grepl("Miniseries|miniseries", Title),
                            !grepl("Renewed|renewed", Title),
                            !grepl("due to premiere", Title))

transmuted <- transmute(netflix_originals, 
                                Title = Title,
                                Genre = str_replace_all(
                                          str_squish(
                                            str_replace_all(
                                              str_replace_all(
                                                str_replace_all(
                                                  str_replace_all(Genre, "series|procedural", ""),
                                                "Science fiction", "Science-Fiction"),
                                              "(C|c)oming-of-age ", ""),
                                            "(C|c)omedy-(D|d)rama", "Dramedy")
                                          ),
                                        "/| ", " / "),
                                Premiere = as.Date(str_replace_all(str_replace_all(Premiere, ",", ""), " ", "-"), "%B-%d-%Y"),
                                Episodes = strtoi(ifelse(!is.na(str_match(Seasons, "([0-9]+) (episode*)")[,2]),
                                                  str_match(Seasons, "([0-9]+) (episode*)")[,2],
                                                  NA)),
                                Seasons = strtoi(ifelse(!is.na(str_match(Seasons, "([0-9]) (season.*|part.*|volume.*)")[,2]),
                                                  str_match(Seasons, "([0-9]) (season.*|part.*|volume.*)")[,2],
                                                  NA)),
                                Min_Time = strtoi(ifelse(!is.na(str_match(Runtime, "([0-9]+)-([0-9]+)")[,2]),
                                                  str_match(Runtime, "([0-9]+)-([0-9]+)")[,2],
                                                  str_match(Runtime, "([0-9]+)")[,2])),
                                Max_Time = strtoi(ifelse(!is.na(str_match(Runtime, "([0-9]+)-([0-9]+)")[,3]),
                                                  str_match(Runtime, "([0-9]+)-([0-9]+)")[,3],
                                                  str_match(Runtime, "([0-9]+)")[,2])),
                                Language = Language,
                                Status = Status
                               )

transmuted
```

```{r}
string <- "23 min."

!is.na(str_match(string, "([0-9]+)-([0-9]+)")[,3])
str_match(string, "([0-9]+)")[,2]

matcher <- str_match(string, "([0-9]+)")
matcher
```

```{r}
string <- "2 seasons, 24 episodes"
!is.na(str_match(string, "([0-9])( season)"))
str_match(string, "([0-9])( season)")
```

